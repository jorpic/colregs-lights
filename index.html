<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <style>
    svg {
      background-color: black;
    }
  </style>

  <body>
      <svg
        xmlns="http://www.w3.org/2000/svg" version="1.1"
        viewBox="-20 -20 40 20"
        width="500" height="500"
      >
        <g id="sideView"></g>
      </svg>
      <svg
        xmlns="http://www.w3.org/2000/svg" version="1.1"
        viewBox="-20 -20 40 40"
        width="500" height="500"
      >
        <g id="topView"></g>
      </svg>
  </body>
  <script>
      const lights = {
        top: {
          color: "white",
          range: {from: -122.5, to: 122.5}
        },
        back: {
          color: "lightyellow",
          range: {from: 122.5, to: -122.5}
        },
        left: {
          color: "red",
          range: {from: 0, to: 122.5}
        },
        right: {
          color: "green",
          range: {from: -122.5, to: 0}
        }
      };

      const ships = {
        small: {
          width: 6,
          length: 16,
          lights: {
            top:   {x: 8, y:  0, z: 15},
            back:  {x: 0.1, y:  0, z: 5},
            left:  {x: 6, y:  2, z: 5},
            right: {x: 6, y: -2, z: 5},
          }
        }
      };

      const topView = document.getElementById("topView");
      const sideView = document.getElementById("sideView");

      function forEachKey(obj, fn) {
        Object.entries(obj).forEach(([k, v]) => fn(k, v))
      }

      function mkSvg(name, attrs) {
        const e = document.createElementNS(
          "http://www.w3.org/2000/svg",
          name);
        forEachKey(attrs, (k,v) => e.setAttribute(k, v));
        return e;
      }

      function mkLight(l, x, y) {
        return mkSvg("circle", {
          cx: x,
          cy: -y,
          r: 1,
          fill: l.color
        })
      }

      function mkShipTop(s) {
        const e = mkSvg("g", {});
        forEachKey(s.lights, (name, pos) =>
          e.appendChild(mkLight(lights[name], pos.x, pos.y))
        );
        e.appendChild(mkSvg("line", {
          stroke: "white",
          "stroke-width": 0.1,
          x1: 0, x2: s.length, y1: 0, y2: 0
        }));
        e.appendChild(mkSvg("line", {
          stroke: "white",
          "stroke-width": 0.1,
          x1: 0, x2: 0, y1: -s.width/2, y2: s.width/2
        }));
        return e;
      }

      topView.appendChild(mkShipTop(ships.small));

      let shipDirection = 1;

      function mkShipSide(s) {
        const e = mkSvg("g", {});
        forEachKey(s.lights, (name, pos) => {
          const alpha = Math.PI*shipDirection/180;
          const beta = alpha - Math.atan(-pos.y / pos.x);
          const x = Math.cos(beta) * Math.sqrt(pos.x * pos.x + pos.y * pos.y);
          e.appendChild(mkLight(lights[name], x, pos.z));
        });
        return e;
      }

      sideView.appendChild(mkShipSide(ships.small));

      function rotateShip() {
        topView.setAttribute("transform", `rotate(${shipDirection})`);
        sideView.innerHTML = "";
        sideView.appendChild(mkShipSide(ships.small));
        window.requestAnimationFrame(rotateShip);
      }

      window.requestAnimationFrame(rotateShip);

      function changeDirection(delta) {
        shipDirection = (shipDirection + delta/2) % 360;
      }

      document.addEventListener("mousemove",
        e => e.buttons && changeDirection(e.movementX)
      );

      let prevTouch = null;
      document.addEventListener("touchmove",
        e => {
          e.preventDefault();
          const newTouch = e.touches[0].clientX;
          prevTouch && changeDirection(prevTouch - newTouch);
          prevTouch = newTouch;
        },
        {passive: false}
      );
  </script>
</html>
